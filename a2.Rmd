---
title: "D3S Assignment 2"
author: "Karnav Popat"
date: "25/03/2024"
output: html_document
---

```{r setup&import, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(dplyr)
library(lubridate)
library(kableExtra)
library(ggplot2)
library(ggthemes)
library(ggrepel)
library(sf)
```

```{r data, include=FALSE}
districts <- read.csv("D:/ashoka/sem6/d3s/shrug/dis_key.csv")
abstract <- read.csv("D:/ashoka/sem6/d3s/shrug/pc11_pca_clean_pc11dist.csv")
vd <- read.csv("D:/ashoka/sem6/d3s/shrug/pc11_vd_clean_pc11dist.csv")
td <- read.csv("D:/ashoka/sem6/d3s/shrug/pc11_td_clean_pc11dist.csv")
data <- left_join(districts, abstract, by = "pc11_district_id")
data <- left_join(data, vd, by = "pc11_district_id")
data <- left_join(data, td, by = "pc11_district_id")

district_shp <- st_read("D:/ashoka/sem6/d3s/shp/district.shp")
```

``` {r data table, include=FALSE}
kable(head(data))
```

![The seven layers of ggplot!](C:/Users/KARNAV/Downloads/2017-10-24-14_36_29-visualization-layers-of-ggplot-google-docs.png)

## Question 1

### 1 (a)

The mean number of allopathic hospitals in a district is 18.5. The median is 10.


``` {r q1a}
data <- data%>%
  mutate(total_hospitals=pc11_vd_all_hosp+pc11_td_all_hospital)

summary_stats <- data %>%
  summarize(mean_village_hospitals = mean(pc11_vd_all_hosp, na.rm=TRUE),
            median_village_hospitals = median(pc11_vd_all_hosp, na.rm=TRUE),
            mean_town_hospitals = mean(pc11_td_all_hospital, na.rm=TRUE),
            median_town_hospitals = median(pc11_td_all_hospital, na.rm=TRUE),
            mean_hospitals = mean(total_hospitals, na.rm=TRUE),
            median_hospitals = median(total_hospitals, na.rm=TRUE))%>%
  pivot_longer(cols = everything(), names_to = "Statistic", values_to = "Value")
```

``` {r q1a table, echo=FALSE}
kable(summary_stats)
```

### 1 (b)

The mean number of allopathic hospitals per lakh people in a district is 1.27. The median is 0.72.

``` {r q1b}
data <- data%>%
  mutate(vd_hospitals_pp=pc11_vd_all_hosp/(pc11_pca_tot_p/100000))%>%
  mutate(td_hospitals_pp=pc11_td_all_hospital/(pc11_pca_tot_p/100000))%>%
  mutate(total_hospitals_pp=total_hospitals/(pc11_pca_tot_p/100000))

summary_stats_pp <- data %>%
  summarize(mean_village_hospitals_per_person = mean(vd_hospitals_pp, na.rm=TRUE),
            median_village_hospitals_per_person = median(vd_hospitals_pp, na.rm=TRUE),
            mean_town_hospitals_per_person = mean(td_hospitals_pp, na.rm=TRUE),
            median_town_hospitals_per_person = median(td_hospitals_pp, na.rm=TRUE),
            mean_hospitals_per_person = mean(total_hospitals_pp, na.rm=TRUE),
            median_hospitals_per_person = median(total_hospitals_pp, na.rm=TRUE))%>%
  pivot_longer(cols = everything(), names_to = "Statistic", values_to = "Value")
```

``` {r q1b table, echo=FALSE}
kable(summary_stats_pp)
```

### 1 (c)

``` {r q1c}
best_district <- data %>%
  select("district_name", "total_hospitals")%>%
  arrange(desc(total_hospitals)) %>%
  slice(1)

best_district_pp <- data %>%
  select("district_name", "total_hospitals_pp")%>%
  arrange(desc(total_hospitals_pp)) %>%
  slice(1)
```

The district with the highest number of allopathic hospitals is Maldah in West Bengal, with 327.

``` {r q1c table, echo=FALSE}
kable(best_district)
```

The district with the highest number of allopathic hospitals per lakh people is Mokokchung in Nagaland, with 16.4.

``` {r q1c table2, echo=FALSE}
kable(best_district_pp)
```

## Question 2

### 2 (a)

Punjab has the highest % of SC population at the district-level, with a median value of 33%.

``` {r q2a}
data <- data%>%
  mutate(sc_percent = pc11_pca_p_sc/pc11_pca_tot_p)

q2a_plot <- data %>%
  group_by(pc11_state_id)%>%
  summarise(median_sc=median(sc_percent), na.rm=TRUE)%>%
  arrange(median_sc)

data["pc11_state_id"] <- factor(data$pc11_state_id, levels = q2a_plot$pc11_state_id)

best_district_sc <- q2a_plot %>%
  select("pc11_state_id", "median_sc")%>%
  arrange(desc(median_sc)) %>%
  slice(1)
```

``` {r q2a graph, echo=FALSE}
ggplot(data, aes(x = factor(pc11_state_id), y = sc_percent)) +
  geom_boxplot() +
  labs(title = "% of SC Population by State") +
  xlab("State/UT") +
  ylab("% SC Population")
```

``` {r q2a table, echo=FALSE}
kable(best_district_sc)
```


### 2 (b)

``` {r q2b}
district_shp <- merge(district_shp, data, by.x="pc11_d_id", by.y="pc11_district_id")
```

``` {r q2b graph, echo=FALSE}
ggplot(district_shp) +
geom_sf(aes(fill = sc_percent)) +
  scale_fill_viridis_c(option="A") +
  labs(title = "Median % SC Population by District")
```

### 2 (c)

Can't tell without substituting the state IDs for state names. The values seem about right though, with a concentration at 15% or so, the worst states being at less than 10%, and the best being around 33.

### 2 (d)

### 2 (e)

The bivariate regression indicates that the percentage of SC population in a district has very little effect on the number of allopathic hospitals per lakh population. An R-square value of 0.00 indicates that our independent variable explains essentially none of the variation in our dependent variable. A p-value of 0.029 is far from statistically significant, indicating that this regression does not decisively point to a statistical effect.

``` {r q2e}
model <- lm(total_hospitals_pp ~ sc_percent, data = data)
summary(model)
```

``` {r q2e graph, echo=FALSE}
ggplot(data, aes(x = sc_percent, y = total_hospitals_pp)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") + 
  labs(title = "Our bivariate regression")
```

### 2 (f)


